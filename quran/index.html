
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quran Study Platform</title>

<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">

<style>
body {
  font-family: Arial, sans-serif;
  background: #ffffff;
  color: #222;
  padding: 40px;
  transition: 0.3s;
}

.dark {
  background: #1c1c1c;
  color: #f1f1f1;
}

h1 { margin-bottom: 20px; }

.controls {
  margin-bottom: 25px;
}

select, button {
  padding: 8px 12px;
  margin-right: 10px;
  border: 1px solid #ccc;
  background: white;
  cursor: pointer;
}

button.primary {
  background: #2e7d32;
  color: white;
  border: none;
}

.ayah {
  margin-bottom: 40px;
  padding-bottom: 25px;
  border-bottom: 1px solid #eee;
}

.arabic {
  font-family: 'Amiri', serif;
  font-size: 30px;
  direction: rtl;
  text-align: right;
  line-height: 1.8;
  margin-bottom: 10px;
}

.word {
  cursor: pointer;
  padding: 2px;
}

.word:hover {
  background: #e0f2f1;
}

.translation {
  margin-bottom: 10px;
}

.tafseer-container {
  margin-top: 15px;
  display: none;
}

.tafseer-columns {
  display: flex;
  gap: 20px;
}

.tafseer-box {
  flex: 1;
  background: #f3f6f9;
  padding: 12px;
  border-left: 4px solid #2e7d32;
  font-size: 14px;
}

.popup {
  position: absolute;
  background: white;
  border: 1px solid #ccc;
  padding: 8px;
  font-size: 13px;
  display: none;
  z-index: 999;
}

.dark .popup {
  background: #2a2a2a;
  color: white;
}
</style>
</head>

<body>

<h1>Quran Study Platform</h1>

<div class="controls">
  <select id="surahSelect"></select>

  <select id="tafseerSelect1">
    <option value="169">Ibn Kathir</option>
    <option value="168">Jalalayn</option>
  </select>

  <select id="tafseerSelect2">
    <option value="">None</option>
    <option value="169">Ibn Kathir</option>
    <option value="168">Jalalayn</option>
  </select>

  <button class="primary" onclick="toggleStudy()">ðŸ“˜ Study Mode</button>
  <button onclick="toggleDark()">ðŸŒ™ Night</button>
</div>

<div id="ayahContainer"></div>
<div id="popup" class="popup"></div>

<script>

const surahSelect = document.getElementById("surahSelect");
const ayahContainer = document.getElementById("ayahContainer");
const popup = document.getElementById("popup");

let studyMode = false;

function toggleDark() {
  document.body.classList.toggle("dark");
}

function toggleStudy() {
  studyMode = !studyMode;
  loadSurah(surahSelect.value);
}

async function loadSurahs() {
  const res = await fetch("https://api.quran.com/api/v4/chapters");
  const data = await res.json();

  data.chapters.forEach(ch => {
    const option = document.createElement("option");
    option.value = ch.id;
    option.textContent = ch.id + ". " + ch.name_simple;
    surahSelect.appendChild(option);
  });

  loadSurah(1);
}

async function loadSurah(id) {

  ayahContainer.innerHTML = "Loading...";

  const res = await fetch(
    `https://api.quran.com/api/v4/verses/by_chapter/${id}?translations=20&words=true&fields=text_uthmani`
  );

  const data = await res.json();
  ayahContainer.innerHTML = "";

  for (const verse of data.verses) {

    const div = document.createElement("div");
    div.classList.add("ayah");

    let arabicHTML = "";

    if (studyMode) {
      verse.words.forEach(w => {
        arabicHTML += `<span class="word"
          onclick="showWord(event,'${w.translation?.text || ''}','${w.root || ''}','${w.part_of_speech || ''}')">
          ${w.text_uthmani}
        </span> `;
      });
    } else {
      arabicHTML = verse.text_uthmani;
    }

    div.innerHTML = `
      <div class="arabic">${arabicHTML}</div>
      <div class="translation">${verse.translations[0].text}</div>
      <button onclick="loadTafseer('${verse.verse_key}', this)">Show Tafseer</button>
      <div class="tafseer-container"></div>
    `;

    ayahContainer.appendChild(div);
  }
}

async function loadTafseer(verseKey, btn) {

  const container = btn.nextElementSibling;
  const t1 = document.getElementById("tafseerSelect1").value;
  const t2 = document.getElementById("tafseerSelect2").value;

  container.innerHTML = "Loading...";
  container.style.display = "block";

  let html = `<div class="tafseer-columns">`;

  const tafseers = [t1, t2].filter(t => t);

  for (const tafseerId of tafseers) {
    const res = await fetch(
      `https://api.quran.com/api/v4/tafsirs/${tafseerId}/by_ayah/${verseKey}`
    );
    const data = await res.json();

    html += `
      <div class="tafseer-box">
        <strong>${document.querySelector(
          "#tafseerSelect1 option[value='"+tafseerId+"'], #tafseerSelect2 option[value='"+tafseerId+"']"
        ).textContent}</strong>
        <br><br>
        ${data.tafsir.text}
      </div>
    `;
  }

  html += `</div>`;
  container.innerHTML = html;
}

function showWord(event, meaning, root, pos) {
  popup.style.display = "block";
  popup.style.left = event.pageX + "px";
  popup.style.top = event.pageY + "px";
  popup.innerHTML = `
    <strong>Meaning:</strong> ${meaning}<br>
    <strong>Root:</strong> ${root}<br>
    <strong>Part of Speech:</strong> ${pos}
  `;
}

document.addEventListener("click", (e) => {
  if (!e.target.classList.contains("word")) {
    popup.style.display = "none";
  }
});

surahSelect.addEventListener("change", e => {
  loadSurah(e.target.value);
});

loadSurahs();

</script>

</body>
</html>
