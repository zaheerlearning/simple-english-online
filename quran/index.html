<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quran Study Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Amiri&display=swap" rel="stylesheet">

<style>
body {
  font-family: Arial;
  padding: 20px;
  background: #fff;
  color: #222;
}

.dark { background: #1c1c1c; color: #eee; }

.arabic {
  font-family: 'Amiri', serif;
  font-size: 28px;
  direction: rtl;
  text-align: right;
  margin-bottom: 10px;
}

.ayah {
  margin-bottom: 25px;
  padding-bottom: 15px;
  border-bottom: 1px solid #ddd;
}

.controls {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 20px;
}

button, select, input {
  padding: 6px 10px;
}

footer {
  margin-top: 40px;
  font-size: 13px;
  border-top: 1px solid #ccc;
  padding-top: 20px;
}
</style>
</head>

<body>

<h2>Quran Study Platform</h2>

<div class="controls">
  <input type="text" id="ayahJump" placeholder="Jump to (e.g. 2:255)">
  <button onclick="jumpToAyah()">Go</button>

  <select id="surahSelect"></select>

  <select id="reciterSelect">
    <option value="Alafasy_128kbps">Mishary Alafasy</option>
    <option value="Sudais_128kbps">Sudais</option>
    <option value="Minshawi_Murattal_128kbps">Minshawi</option>
  </select>

  <button onclick="toggleDark()">Night</button>
</div>

<div id="ayahContainer"></div>

<footer>
<b>Attribution & Disclaimer</b><br><br>
Arabic text sourced from the Tanzil Project (Uthmani script).<br>
English translation and Tafseer fetched via Quran.com API.<br>
All rights belong to their respective authors and publishers.<br>
This platform is intended as a study tool and does not replace qualified scholarly guidance.
</footer>

<script>

let arabicData = [];
let currentAudio = null;

async function loadArabic() {
  const res = await fetch("data/quran-arabic.json");
  arabicData = await res.json();
  populateSurahSelect();
  loadSurah(1);
}

function populateSurahSelect() {
  const surahSelect = document.getElementById("surahSelect");
  for (let i = 1; i <= 114; i++) {
    let opt = document.createElement("option");
    opt.value = i;
    opt.textContent = "Surah " + i;
    surahSelect.appendChild(opt);
  }

  surahSelect.addEventListener("change", () => {
    loadSurah(surahSelect.value);
  });
}

async function loadSurah(surahNumber) {

  const container = document.getElementById("ayahContainer");
  container.innerHTML = "Loading...";

  const translationRes = await fetch(
    `https://api.quran.com/api/v4/verses/by_chapter/${surahNumber}?translations=20`
  );
  const translationData = await translationRes.json();

  container.innerHTML = "";

  translationData.verses.forEach(v => {

    const verseKey = v.verse_key;

    const arabicVerse = arabicData.find(a => a.verse_key === verseKey);

    const div = document.createElement("div");
    div.classList.add("ayah");

    div.innerHTML = `
      <div class="arabic">${arabicVerse ? arabicVerse.text : ""}</div>
      <div>${v.translations[0].text}</div>
      <button onclick="playAyah('${verseKey}')">Play</button>
      <button onclick="loadTafseer('${verseKey}', this)">Tafseer</button>
      <div class="tafseer-box"></div>
    `;

    container.appendChild(div);
  });
}

function playAyah(verseKey) {

  const reciter = document.getElementById("reciterSelect").value;

  const parts = verseKey.split(":");
  const surah = parts[0].padStart(3,'0');
  const ayah = parts[1].padStart(3,'0');

  const url = `https://everyayah.com/data/${reciter}/${surah}${ayah}.mp3`;

  if (currentAudio) currentAudio.pause();

  currentAudio = new Audio(url);
  currentAudio.play();
}

async function loadTafseer(verseKey, btn) {

  const box = btn.nextElementSibling;
  box.innerHTML = "Loading...";

  const res = await fetch(
    `https://api.quran.com/api/v4/tafsirs/169/by_ayah/${verseKey}`
  );
  const data = await res.json();

  box.innerHTML = "<b>Tafseer Ibn Kathir</b><br><br>" + data.tafsir.text;
}

function jumpToAyah() {

  const input = document.getElementById("ayahJump").value;

  if (!input.includes(":")) return;

  const [surah, ayah] = input.split(":");

  document.getElementById("surahSelect").value = surah;
  loadSurah(surah);

  setTimeout(() => {
    const element = document.querySelectorAll(".ayah")[ayah - 1];
    if (element) element.scrollIntoView({behavior: "smooth"});
  }, 1000);
}

function toggleDark() {
  document.body.classList.toggle("dark");
}

loadArabic();

</script>

</body>
</html>
