<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quran Study Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Inter', sans-serif;
  margin:0;
  background:#f6fbf8;
  background-image: radial-gradient(#d1fae5 1px, transparent 1px);
  background-size: 40px 40px;
  color:#1f2937;
}

.dark { background:#0f172a; color:#e5e7eb; background-image:none; }

/* Sticky Header */
.header {
  position:sticky;
  top:0;
  z-index:999;
  background:white;
  padding:18px;
  box-shadow:0 4px 14px rgba(0,0,0,0.06);
}
.dark .header { background:#1e293b; }

.header h1 {
  margin:0;
  text-align:center;
  font-size:20px;
  color:#166534;
}

/* Controls */
.controls {
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  margin-top:12px;
}

/* Inputs */
input, select {
  padding:8px 12px;
  border-radius:8px;
  border:1px solid #cbd5e1;
  background:#f8fafc;
}
.dark input, .dark select {
  background:#334155;
  border:1px solid #475569;
  color:white;
}

/* Buttons */
button {
  padding:8px 14px;
  border:none;
  border-radius:8px;
  cursor:pointer;
  font-weight:500;
  transition:0.2s;
}
button:hover { transform:translateY(-1px); opacity:0.9; }

button[onclick*="playFullSurah"] { background:#2563eb; color:white; }
button[onclick*="pauseAudio"] { background:#f59e0b; color:white; }
button[onclick*="stopAudio"] { background:#ef4444; color:white; }
button[onclick*="toggleStudy"] { background:#16a34a; color:white; }
button[onclick*="toggleDark"] { background:#334155; color:white; }

/* Surah Title */
#surahTitle {
  text-align:center;
  margin:30px 0 10px;
}

#surahTitle h2 {
  font-size:26px;
  margin:0;
  color:#14532d;
}
.dark #surahTitle h2 { color:#4ade80; }

#surahMeta {
  font-size:14px;
  color:#64748b;
  margin-top:6px;
}
.dark #surahMeta { color:#94a3b8; }

/* Decorative SVG Divider */
.divider {
  margin:15px auto;
  width:200px;
}

/* Ayah Card */
.ayah {
  background:white;
  max-width:900px;
  margin:20px auto;
  padding:22px;
  border-radius:14px;
  box-shadow:0 4px 14px rgba(0,0,0,0.05);
  transition:0.3s;
  opacity:0;
  transform:translateY(10px);
  animation:fadeIn 0.4s ease forwards;
}
.dark .ayah { background:#1e293b; }

@keyframes fadeIn {
  to { opacity:1; transform:translateY(0); }
}

.ayah.active {
  border-left:6px solid #16a34a;
  background:#ecfdf5;
}
.dark .ayah.active { background:#064e3b; }

/* Arabic */
.arabic {
  font-family:'Amiri', serif;
  font-size:32px;
  direction:rtl;
  text-align:right;
  line-height:2;
  margin-bottom:12px;
}

/* Popup */
#wordPopup {
  position:absolute;
  background:white;
  padding:10px;
  border-radius:10px;
  box-shadow:0 8px 20px rgba(0,0,0,0.1);
  display:none;
  z-index:1000;
  max-width:260px;
}
.dark #wordPopup { background:#334155; color:white; }

/* Floating Player */
#floatingPlayer {
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  background:#111827;
  color:white;
  padding:12px;
  display:none;
  justify-content:center;
  align-items:center;
  gap:15px;
  font-size:14px;
}

/* Reading Progress */
#progressBar {
  position:fixed;
  top:0;
  left:0;
  height:4px;
  background:#16a34a;
  width:0%;
  z-index:1000;
}

/* Footer */
footer {
  margin:40px auto;
  max-width:900px;
  text-align:center;
  font-size:13px;
  color:#64748b;
}
.dark footer { color:#94a3b8; }

@media(max-width:768px){
  .controls { flex-direction:column; align-items:stretch; }
}
</style>
</head>

<body>

<div id="progressBar"></div>

<div class="header">
  <h1><span style="font-family:'Amiri';font-size:24px;">Ô∑Ω</span> Quran Study Platform</h1>
  <div class="controls">
    <input type="text" id="ayahJump" placeholder="Jump (2:255)">
    <button onclick="jumpToAyah()">Go</button>
    <select id="surahSelect"></select>
    <button onclick="playFullSurah()">‚ñ∂ Play Surah</button>
    <button onclick="pauseAudio()">‚è∏</button>
    <button onclick="stopAudio()">‚èπ</button>
    <button onclick="toggleDark()">Night</button>
  </div>
</div>

<div id="surahTitle">
  <h2 id="surahName"></h2>
  <p id="surahMeta"></p>
  <svg class="divider" viewBox="0 0 200 20">
    <path d="M0 10 L200 10" stroke="#16a34a" stroke-width="2"/>
  </svg>
</div>

<div id="ayahContainer"></div>
<div id="wordPopup"></div>

<div id="floatingPlayer">
  üéß Playing Surah... <button onclick="stopAudio()">Stop</button>
</div>

<footer>
Arabic, translation & tafseer via Quran.com API.<br>
Audio via EveryAyah.<br>
For study purposes only.
</footer>

<script>
let surahMetaData=[];
let surahVerses=[];
let currentAudio=null;
let currentIndex=0;
let isFullPlaying=false;

/* Load Surahs */
async function loadSurahNames(){
  const res=await fetch("https://api.quran.com/api/v4/chapters");
  const data=await res.json();
  surahMetaData=data.chapters;

  const select=document.getElementById("surahSelect");
  data.chapters.forEach(ch=>{
    let opt=document.createElement("option");
    opt.value=ch.id;
    opt.textContent=ch.id+". "+ch.name_simple;
    select.appendChild(opt);
  });
  loadSurah(1);
}

async function loadSurah(surah){
  const meta=surahMetaData.find(s=>s.id==surah);
  if(meta){
    document.getElementById("surahName").textContent=
      meta.name_simple+" ("+meta.name_arabic+")";
    document.getElementById("surahMeta").textContent=
      meta.revelation_place+" ‚Ä¢ "+meta.verses_count+" Ayahs";
  }

  const container=document.getElementById("ayahContainer");
  container.innerHTML="Loading...";

  const res=await fetch(`https://api.quran.com/api/v4/verses/by_chapter/${surah}?translations=20&fields=text_uthmani`);
  const data=await res.json();
  surahVerses=data.verses;
  container.innerHTML="";

  surahVerses.forEach((v,i)=>{
    let div=document.createElement("div");
    div.className="ayah";
    div.id="ayah-"+i;
    div.innerHTML=`
      <div class="arabic">${v.text_uthmani}</div>
      <div>${v.translations[0].text}</div>
      <button onclick="playSingle(${i})">Play</button>
      <button onclick="bookmarkAyah('${v.verse_key}')">üîñ</button>
    `;
    container.appendChild(div);
  });
}

/* Audio */
function playFullSurah(){
  isFullPlaying=true;
  currentIndex=0;
  document.getElementById("floatingPlayer").style.display="flex";
  playNext();
}

function playNext(){
  if(!isFullPlaying||currentIndex>=surahVerses.length)return;
  playAudio(currentIndex);
  currentAudio.onended=()=>{
    currentIndex++;
    playNext();
  }
}

function playSingle(index){
  isFullPlaying=false;
  playAudio(index);
}

function playAudio(index){
  document.querySelectorAll(".ayah").forEach(a=>a.classList.remove("active"));
  document.getElementById("ayah-"+index).classList.add("active");

  const verseKey=surahVerses[index].verse_key;
  const parts=verseKey.split(":");
  const url=`https://everyayah.com/data/Alafasy_128kbps/${parts[0].padStart(3,'0')}${parts[1].padStart(3,'0')}.mp3`;

  if(currentAudio) currentAudio.pause();
  currentAudio=new Audio(url);
  currentAudio.play();
}

function pauseAudio(){ if(currentAudio) currentAudio.pause(); }
function stopAudio(){
  if(currentAudio){ currentAudio.pause(); currentAudio.currentTime=0; }
  isFullPlaying=false;
  document.getElementById("floatingPlayer").style.display="none";
}

/* Bookmark */
function bookmarkAyah(key){
  localStorage.setItem("bookmark",key);
  alert("Bookmarked: "+key);
}

/* Jump */
function jumpToAyah(){
  const input=document.getElementById("ayahJump").value;
  if(!input.includes(":"))return;
  const [s,a]=input.split(":");
  document.getElementById("surahSelect").value=s;
  loadSurah(s);
  setTimeout(()=>{
    const el=document.querySelectorAll(".ayah")[a-1];
    if(el)el.scrollIntoView({behavior:"smooth"});
  },800);
}

/* Scroll Progress */
window.addEventListener("scroll",()=>{
  const total=document.documentElement.scrollHeight-window.innerHeight;
  const progress=(window.scrollY/total)*100;
  document.getElementById("progressBar").style.width=progress+"%";
});

document.getElementById("surahSelect").addEventListener("change",e=>{
  loadSurah(e.target.value);
});

loadSurahNames();
</script>
</body>
</html>
