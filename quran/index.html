<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quran Study Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --emerald:#0f766e;
  --emerald-soft:#0d9488;
  --bg-light:#f6f8f7;
  --card-light:#ffffff;
  --bg-dark:#0b1220;
  --card-dark:#121a2b;
  --text-light:#1f2937;
  --text-dark:#e5e7eb;
  --arabic-dark:#f3efe6;
}

body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:var(--bg-light);
  color:var(--text-light);
  transition:all .3s ease;
}

.dark{
  background:var(--bg-dark);
  color:var(--text-dark);
}

header{
  position:sticky;
  top:0;
  background:var(--card-light);
  padding:15px;
  box-shadow:0 2px 12px rgba(0,0,0,0.06);
  z-index:100;
}

.dark header{
  background:var(--card-dark);
}

h2{
  text-align:center;
  margin:0 0 12px 0;
  font-weight:600;
}

.controls-row{
  display:flex;
  flex-wrap:wrap;
  gap:10px;
  justify-content:center;
  margin-bottom:8px;
}

select, button{
  padding:10px 16px;
  border-radius:10px;
  border:none;
  font-weight:600;
  cursor:pointer;
  font-size:14px;
}

button{
  background:var(--emerald);
  color:white;
  transition:.2s ease;
}

button:hover{
  background:var(--emerald-soft);
}

.secondary{
  background:#334155;
}

.warning{ background:#f59e0b; }
.danger{ background:#dc2626; }

.dropdown{
  position:relative;
}

.dropdown-menu{
  position:absolute;
  top:48px;
  left:0;
  background:var(--card-light);
  padding:12px;
  border-radius:12px;
  box-shadow:0 10px 25px rgba(0,0,0,0.12);
  display:none;
  flex-direction:column;
  gap:8px;
  min-width:220px;
}

.dark .dropdown-menu{
  background:var(--card-dark);
}

.dropdown.open .dropdown-menu{
  display:flex;
}

main{
  max-width:850px;
  margin:auto;
  padding:20px;
}

.ayah{
  background:var(--card-light);
  padding:22px;
  border-radius:16px;
  margin-bottom:20px;
  box-shadow:0 4px 18px rgba(0,0,0,0.05);
  transition:.2s ease;
}

.dark .ayah{
  background:var(--card-dark);
}

.ayah.active{
  border-left:5px solid var(--emerald);
}

.arabic{
  font-family:'Amiri',serif;
  font-size:clamp(24px,4vw,34px);
  direction:rtl;
  text-align:right;
  margin-bottom:14px;
}

.dark .arabic{
  color:var(--arabic-dark);
}

.translation{
  margin-top:6px;
  line-height:1.6;
}

.urdu{
  direction:rtl;
}

.button-row{
  margin-top:14px;
  display:flex;
  gap:12px;
  flex-wrap:wrap;
}

.tafseer-panel{
  position:fixed;
  bottom:0;
  right:0;
  width:100%;
  max-height:85%;
  background:var(--card-light);
  border-top-left-radius:20px;
  border-top-right-radius:20px;
  padding:22px;
  transform:translateY(100%);
  transition:.35s ease;
  overflow:auto;
  z-index:200;
}

.dark .tafseer-panel{
  background:var(--card-dark);
}

.tafseer-panel.open{
  transform:translateY(0);
}

.close-btn{
  background:#dc2626;
  margin-bottom:12px;
}

@media(min-width:900px){
  .tafseer-panel{
    top:0;
    bottom:auto;
    width:450px;
    height:100vh;
    transform:translateX(100%);
    border-radius:0;
  }
  .tafseer-panel.open{
    transform:translateX(0);
  }
}

.audio-bar{
  position:fixed;
  bottom:0;
  width:100%;
  background:rgba(255,255,255,0.9);
  backdrop-filter:blur(6px);
  padding:10px;
  display:none;
  flex-direction:column;
  gap:6px;
}

.dark .audio-bar{
  background:rgba(18,26,43,0.9);
}

.audio-bar.active{
  display:flex;
}

.progress{
  width:100%;
  height:4px;
  background:#ddd;
  border-radius:3px;
}

.progress-bar{
  height:100%;
  width:0%;
  background:var(--emerald);
  border-radius:3px;
}
</style>
</head>

<body>

<header>
<h2>Quran Study Platform</h2>

<div class="controls-row">
<select id="surahSelect"></select>
<select id="reciterSelect">
<option value="Alafasy_128kbps">Alafasy</option>
<option value="Abdurrahmaan_As-Sudais_192kbps">Sudais</option>
<option value="Saood_ash-Shuraym_128kbps">Shuraim</option>
<option value="Maher_Al_Muaiqly_128kbps">Maher</option>
<option value="Husary_128kbps">Husary</option>
</select>
<button onclick="playFullSurah()">Play</button>
<button class="warning" onclick="pauseAudio()">Pause</button>
<button class="danger" onclick="stopAudio()">Stop</button>
</div>

<div class="controls-row">

<div class="dropdown" id="transDrop">
<button class="secondary" onclick="toggleDrop('transDrop')">Translation ▼</button>
<div class="dropdown-menu">
<label><input type="checkbox" id="showEnglish" checked> English</label>
<label><input type="checkbox" id="showUrduTaqi"> Urdu (Taqi)</label>
<label><input type="checkbox" id="showUrduJalandhari"> Urdu (Jalandhari)</label>
</div>
</div>

<select id="tafseerSelect">
<option value="169">Ibn Kathir (English)</option>
<option value="168">Jalalayn (English)</option>
</select>

<button class="secondary" onclick="toggleDark()">Night</button>
</div>
</header>

<main>
<div id="ayahContainer"></div>
</main>

<div class="tafseer-panel" id="tafseerPanel">
<button class="close-btn" onclick="closeTafseer()">Close</button>
<h3 id="tafseerHeader"></h3>
<div id="tafseerArabic"></div>
<div id="tafseerContent"></div>
</div>

<div class="audio-bar" id="audioBar">
<div id="mobileAyah"></div>
<div style="display:flex;justify-content:center;gap:10px;">
<button onclick="prevAyah()">⏮</button>
<button onclick="resumeAudio()">▶</button>
<button onclick="pauseAudio()">⏸</button>
<button onclick="stopAudio()">⏹</button>
<button onclick="nextAyah()">⏭</button>
</div>
<div class="progress"><div class="progress-bar" id="progressBar"></div></div>
</div>

<script>
let verses=[];
let currentAudio=new Audio();
let currentIndex=0;
let fullMode=false;

function toggleDrop(id){
document.querySelectorAll(".dropdown").forEach(d=>d.classList.remove("open"));
document.getElementById(id).classList.toggle("open");
}

document.addEventListener("click",e=>{
if(!e.target.closest(".dropdown")){
document.querySelectorAll(".dropdown").forEach(d=>d.classList.remove("open"));
}
});

async function loadSurahNames(){
const res=await fetch("https://api.quran.com/api/v4/chapters");
const data=await res.json();
const select=document.getElementById("surahSelect");
data.chapters.forEach(ch=>{
let opt=document.createElement("option");
opt.value=ch.id;
opt.textContent=ch.id+". "+ch.name_simple;
select.appendChild(opt);
});
loadSurah(1);
}

async function loadSurah(surah){
stopAudio();
const res=await fetch(`https://api.quran.com/api/v4/verses/by_chapter/${surah}?translations=20,131,97&translation_fields=text&fields=text_uthmani`);
const data=await res.json();
verses=data.verses || [];
renderAyahs();
}

function renderAyahs(){
const container=document.getElementById("ayahContainer");
container.innerHTML="";

const showEnglish=document.getElementById("showEnglish").checked;
const showTaqi=document.getElementById("showUrduTaqi").checked;
const showJalandhari=document.getElementById("showUrduJalandhari").checked;

verses.forEach((v,i)=>{
let english="", taqi="", jalandhari="";

if(v.translations){
v.translations.forEach(t=>{
const lang=(t.language_name||"").toLowerCase();
const author=(t.resource_name||"").toLowerCase();
if(lang==="english") english=t.text||"";
if(lang==="urdu"){
if(author.includes("taqi")||author.includes("usmani")) taqi=t.text||"";
if(author.includes("jalandh")) jalandhari=t.text||"";
}
});
}

let div=document.createElement("div");
div.className="ayah";
div.id="ayah-"+i;

div.innerHTML=`
<div class="arabic">${v.text_uthmani}</div>
${showEnglish?`<div class="translation">${english}</div>`:""}
${showTaqi?`<div class="translation urdu">${taqi}</div>`:""}
${showJalandhari?`<div class="translation urdu">${jalandhari}</div>`:""}
<div class="button-row">
<button onclick="playSingle(${i})">Play</button>
<button onclick="openTafseer('${v.verse_key}','${v.text_uthmani}')">Tafseer</button>
</div>
`;
container.appendChild(div);
});
}

document.querySelectorAll("#showEnglish,#showUrduTaqi,#showUrduJalandhari")
.forEach(el=>el.addEventListener("change",renderAyahs));

function buildURL(key){
const reciter=document.getElementById("reciterSelect").value;
const p=key.split(":");
return `https://everyayah.com/data/${reciter}/${p[0].padStart(3,'0')}${p[1].padStart(3,'0')}.mp3`;
}

function playSingle(i){fullMode=false;playAyah(i);}
function playFullSurah(){fullMode=true;currentIndex=0;playAyah(0);}

function playAyah(i){
if(!verses[i]) return;
document.querySelectorAll(".ayah").forEach(a=>a.classList.remove("active"));
document.getElementById("ayah-"+i).classList.add("active");
currentIndex=i;
currentAudio.src=buildURL(verses[i].verse_key);
currentAudio.play();
document.getElementById("audioBar").classList.add("active");
document.getElementById("mobileAyah").innerText="Ayah "+verses[i].verse_key;
currentAudio.onended=()=>{if(fullMode&&currentIndex<verses.length-1){playAyah(currentIndex+1);}};
}

function resumeAudio(){currentAudio.play();}
function pauseAudio(){currentAudio.pause();}
function stopAudio(){
currentAudio.pause();
currentAudio.currentTime=0;
document.getElementById("audioBar").classList.remove("active");
document.querySelectorAll(".ayah").forEach(a=>a.classList.remove("active"));
}

function nextAyah(){if(currentIndex<verses.length-1)playAyah(currentIndex+1);}
function prevAyah(){if(currentIndex>0)playAyah(currentIndex-1);}

currentAudio.addEventListener("timeupdate",()=>{
if(currentAudio.duration){
let progress=(currentAudio.currentTime/currentAudio.duration)*100;
document.getElementById("progressBar").style.width=progress+"%";
}
});

async function openTafseer(key,arabic){
const panel=document.getElementById("tafseerPanel");
panel.classList.add("open");
document.getElementById("tafseerHeader").innerText="Tafseer "+key;
document.getElementById("tafseerArabic").innerText=arabic;
const id=document.getElementById("tafseerSelect").value;
const res=await fetch(`https://api.quran.com/api/v4/tafsirs/${id}/by_ayah/${key}`);
const data=await res.json();
document.getElementById("tafseerContent").innerHTML=data.tafsir.text;
}

function closeTafseer(){document.getElementById("tafseerPanel").classList.remove("open");}
function toggleDark(){document.body.classList.toggle("dark");}

document.getElementById("surahSelect").addEventListener("change",e=>loadSurah(e.target.value));
loadSurahNames();
</script>

</body>
</html>
