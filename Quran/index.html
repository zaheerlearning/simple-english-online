<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Quran Study Platform</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- PWA -->
<link rel="manifest" href="/quran/manifest.json">
<meta name="theme-color" content="#166534">

<link href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  font-family:'Inter',sans-serif;
  background:linear-gradient(to bottom,#f0fdf4,#ecfdf5);
}

header{
  background:linear-gradient(135deg,#14532d,#064e3b);
  color:white;
  padding:20px;
  text-align:center;
  box-shadow:0 4px 15px rgba(0,0,0,.15);
}

main{
  max-width:900px;
  margin:auto;
  padding:20px;
}

.ayah{
  background:white;
  padding:25px;
  border-radius:20px;
  margin-bottom:20px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.arabic{
  font-family:'Amiri',serif;
  font-size:28px;
  direction:rtl;
  text-align:right;
  line-height:2;
}

.translation{
  margin-top:10px;
  color:#374151;
}

.update-bar{
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  background:#065f46;
  color:white;
  padding:12px;
  text-align:center;
  display:none;
  z-index:10001;
}

.update-bar button{
  margin-left:10px;
  background:#22c55e;
  border:none;
  padding:6px 12px;
  border-radius:20px;
}
</style>
</head>

<body>

<header>
<h2>Quran Study Platform</h2>
<select id="surahSelect"></select>
<button onclick="loadSurah(surahSelect.value)">Load</button>
</header>

<main>
<div id="ayahContainer"></div>
</main>

<div class="update-bar" id="updateBar">
  New version available.
  <button onclick="updateApp()">Update</button>
</div>

<script>
let chaptersData=[];
let verses=[];

async function loadSurahNames(){
  const res=await fetch("https://api.quran.com/api/v4/chapters");
  const data=await res.json();
  chaptersData=data.chapters;

  data.chapters.forEach(ch=>{
    let opt=document.createElement("option");
    opt.value=ch.id;
    opt.textContent=ch.id+". "+ch.name_simple;
    surahSelect.appendChild(opt);
  });

  loadSurah(1);
}

async function loadSurah(id){
  const res=await fetch(
    `https://api.quran.com/api/v4/verses/by_chapter/${id}?translations=20&fields=text_uthmani`
  );
  const data=await res.json();
  verses=data.verses;
  render();
}

function render(){
  ayahContainer.innerHTML="";
  verses.forEach(v=>{
    ayahContainer.innerHTML+=`
      <div class="ayah">
        <div class="arabic">${v.text_uthmani}</div>
        <div class="translation">${v.translations[0].text}</div>
      </div>
    `;
  });
}

loadSurahNames();

/* Register Service Worker */
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/quran/service-worker.js')
  .then(reg => {
    reg.onupdatefound = () => {
      const newWorker = reg.installing;
      newWorker.onstatechange = () => {
        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
          document.getElementById("updateBar").style.display="block";
        }
      };
    };
  });
}

function updateApp(){
  window.location.reload();
}
</script>

</body>
</html>
